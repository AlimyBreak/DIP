# <center>形态学图像处理</center>

***

Ref:

1. <<精通Matlab数字图像处理与识别>> 张铮等编著 2013.04.01第一版 Page220

***



## 一.  预备知识

+ 数学形态学，主要应用是从图像中__提取__对于表达和描绘区域形状__有意义__的图像分量，使后续的识别工作能够抓住目标对象最本质(最具区分能力-most discriminative)的形状特征，如__边界__和__连通区域__；同时__像细化__、__像素化__和__修剪毛刺__等技术也常常应用于图像的预处理和后处理中，成为图像增强技术的有力补充.
+ 形态学是借助__集合论__的语言来描述.
  + __结构元素__(structure element):设有两副图像$A$和$S$,若$A$是被处理的对象，而$S$是用来处理$A$的，则称$S$为结构元素。结构元素通常都是一些比较小的图像，$A$与$S$的关系类似滤波中__图像__和__模板__的关系.





## 二.  二值图像中的基本形态学运算

+ __前景认定习惯__：默认情况下白色的(二值图像中的灰度值为1的像素，或灰度图像中灰度值为255的像素)是前景(物体)，黑色的为背景.

### 2.1  腐蚀操作

+ 理论基础
  
  + 对于$Z^2$上的元素集合$A$和$S$,使用$S$对$A$进行腐蚀操作，记做$A\ominus S$,形式化地定义
    $$
    A\ominus S =\{z\mid(S)_z\subseteq A\}
    $$
  
  + 让原本位于图像原点的结构元素$S$在整个$Z^2$平面上移动,如果当$S$的原点平移至$z$点时能完全包含在$A$中,则所有这样$z$点构成的集合即为$S$对$A$的腐蚀图像.
  
  + 可以通过设置$S$的属性来筛选出满足条件的所有$z$点，一般来说所有$z$点构成的集合元素会二值图像中的物体轮廓的图像元素构成的集合元素少一些.
  
+ matlab 函数及用例

  + $erode.m$
  + 效果：

  ![erode](%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86_%E5%BD%A2%E6%80%81%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0.assets/erode.bmp)

+ halcon 函数及用例(略)

+ opencv函数及用例(略)

+ 腐蚀的作用:

  + 腐蚀能消融物体的边界，腐蚀结果与图像本身和结构元素有关
    + 若物体整体上大于结构元素，腐蚀的结果是使得物体"瘦"一圈，这一圈到底是多大由结构元素决定；
    + 若物理本身小于结构元素，则在腐蚀后图像中的物体将完全消失；
    + 若物体仅有部分区域小于结构元素（在细小的连通），则腐蚀后物体会在细小的连通处__断裂__，分离为两部分.



### 2.2  膨胀操作

+ 理论基础

  + 对$Z^2$上元素的集合$A$和$S$,使用$S$对$A$进行膨胀,记作$A\oplus S$,形式化地定义为
    $$
    A\oplus S =\{(\hat{S})_z\cap A\ne\varnothing\}
    $$

  + 设想有原本位于图像原点的结构元素$S$,让$S$在整个$Z^2$平面上移动，当其自身原点平移至$z$点时，$S$相对于其自身的原点的映像$\hat{S}$和$A$有公共交集，即$\hat{S}$和$A$至少有一个像素是重叠的，则所有这样的$z$点构成的集合为$S$对$A$的膨胀图像.

  + 实际上膨胀和腐蚀对于集合求补和反射运算是彼此对偶的，与前景认定习惯相反的图片进行膨胀对应的就是与前景认定习惯相同的图片进行腐蚀一样操作，区别是像素需要取反.

+ MATLAB函数及用例

  + $delilate.m$

  + 效果：

    ![delilate](%E6%95%B0%E5%AD%97%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86_%E5%BD%A2%E6%80%81%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0.assets/delilate.bmp)

+ Halcon函数及用例(略)

+ opencv函数及用例(略)

+ 膨胀的作用:

  + 和反射相反，__膨胀能使物体边界扩大__；具体的膨胀结果与图像本身和结构元素的形状有关，膨胀常用于将图像中原本断裂开来的同一物体桥接起来。
  + 对图像进行二值化之后，很容易使得一个连接的物体断裂为两个部分，而这会给后续的图像分析造成困扰（如要基于连通区域的分析统计物体的个数），此时就可借助膨胀桥接断裂的缝隙.





### 2.3  开运算

+ 开运算和闭运算都是由腐蚀和膨胀复合而成的，__开运算是先腐蚀后膨胀__，而__闭运算是先膨胀后腐蚀__。

+ 理论基础:

  + 使用结构元素$S$对$A$进行开运算，记作$A\circ S$，可表示为
    $$
    A\circ S = (A\ominus S)\oplus S
    $$

  + 一般来说，开运算使图像的轮廓变得光滑，断开狭窄的连接和消除毛刺。

  + 查看imopen中的MATLAB源代码可以发现，就是先腐蚀后膨胀

  ```matlab
  outputImage = imdilate(imerode(inputImage,se,packopt,M),se,packopt,M);
  ```

  



### 2.4  闭运算

+ 开运算和闭运算都是由腐蚀和膨胀复合而成的，__开运算是先腐蚀后膨胀__，而__闭运算是先膨胀后腐蚀__。

+ 理论基础:

  + 使用结构元素$S$对$A$进行闭运算，记作$A\cdot S$,可表示为
  $$
  A\cdot S = (A\oplus S)\ominus S
  $$

  + 查看imclose的MATLAB源代码可以发现，就是先膨胀后腐蚀

  ```matlab
  outputImage = imerode(imdilate(inputImage,se,packopt,M),se,packopt,M);
  ```





## 三.  二值图像中形态学应用

+ 一些经典的形态学应用，都是基本运算(腐蚀、膨胀、开运算和闭运算)的特定次序组合，并采用一些特殊的结构元素来实现的。
  + 击中与击不中变换
  + 边界提取与跟踪
  + 区域填充
  + 连通分量提取及其实现
  + 细化算法
  + 像素化算法





### 3.1  击中与击不中变换及其实现

+ 击中与击不中变换是一种__形状检测的基本工具__，常用于图像中特定形状的精准定位。
+ 理论基础:
  + 记作$A\otimes$


