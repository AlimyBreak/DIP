

# 4.1.1 图像增强概述

+ 图像增强的概念和目的
  +  采用一系列技术__改善图像的视觉效果__,或将__图像转换__成一种更__适合__于人或机器进行__分析__和__处理__的形式.
  +  目的:
     +   改善图像的视觉效果;
     +   突出图像中感兴趣的信息，抑制不需要的信息，来提高图像的使用价值;
     +   转换为更适合人或机器分析处理的形式;
     +   需要注意的一点：增强后的图像不一定保真。
  
+ 图像增强的主要方法
  + 按照图像的作用域区分
    + __空间域增强__:直接对图像各像素进行处理
    + __频率域增强__:对图像经傅立叶变换后的频谱成分进行处理,然后逆傅立叶变换得到需要的图像

+ 图像增强的应用
    + 十分广泛


+ 图像增强的方法
  + __对比度增强__:扩大图像中感兴趣特征的目标
    + __灰度变换法__:通过调整__图像的灰度动态范围或调整图像的对比度__对图像进行增强.
      + 对比度:就是明暗的对比程度
      + __线性变换__:曝光不足或过曝，灰度会局限在很小的范围内，此时可以对曝光不足的图像用线性拉伸，可以有效的改善图像的视觉效果。
        + 分段线性变换:突出感兴趣的目标所在的灰度区间(被拉伸)，抑制不感兴趣的灰度区间(被压缩)
      + __对数变换__
      + __指数变换__
    + __直方图调整法__:
      + __直方图均衡化__
    + __空间域增强__:
    + __频率域增强__:



# 4.1.2 直方图均衡化

+ 灰度直方图的概念
  
+ 用来反应数字图像中每一个__灰度级__与这个灰度级__出现频率__之间的关系，可以描述图像的概貌。
  
+ 直方图修正法
  + 直方图均衡化(主要讲解))
  + 直方图规定化

+ 直方图均衡化
  + 将原图像通过某种变换，得到一副__灰度直方图均匀分布__的新图像.
  + 连续变化图像的均衡化问题:
  若$r$表示归一化的原图像灰度,$s$表示经过修正后的图像灰度.即
  $$
  T(r)=s,0\le r,s \le 1
  $$
  $T(r)$称为变换函数,需要满足以下条件:
  + 条件$1$:在$r\in [0,1]$内,$T(r)$单调递增;
  + 条件$2$:在$r\in [0,1]$内,有$0\le T(r)\le 1$
  条件$1$保证灰度级从黑到白的次序不变;
  条件$2$保证映射后的像素灰度在允许的范围内.
  则反变换关系为
  $$
  r = T^{-1}(s)
  $$
  显然$T^{-1}(s)$对$s$也要满足上述条件$1$和条件$2$.
  从概率论理论我们可以知道，如果已知随机变量$r$的概率密度为$p_r(r)$而随机变量$s$是$r$的函数,则$s$的概率密度$p_s(s)$可以由$p_r(r)$求出
  假定随机变量$s$的分布函数用$F_s(s)$表示,根据分布函数的定义,有(换个积分变量比较好,这里怕搞混直接用了)
  $$
  F_s(s)=\int_{-\infty}^{s}p_s(s)ds = \int_{-\infty}^{r}p_r(r)dr
  $$
  利用__密度函数是分布函数的导数的关系__,等式两边对$s$求导,可以得到:
  $$
  \tag{一}
  P_s(s)=\frac{d}{ds}\left[\int_{-\infty}^{r}p_r(r)dr\right] = p_r\frac{dr}{ds} = p_r\frac{d}{ds}\left[T^{-1}(s)\right]
  $$
  公式$(一)$是__直方图修正级数的基础__:可以通过变换函数$T(r)$控制原图像原图像灰度级的概率密度函数$p_r$，得到输出图像的概率密度函数$p_s$，因此可以改善原图像的灰度层次。
  + 从__人眼视觉特性__来考虑,一副图像的直方图如果是__均匀分布__的，即$P_s(s)=k$(归一化后$k=1$),__该图像色调给人的感觉比较协调__。所以将原图像的直方图均衡化后，可以满足人眼的视觉要求.

  + 如何求出$T(r)$
    +  根据归一化假设
    $$
    P_s(s) = 1
    $$
    由公式$(一)$得到(左边等于1):
    $$
    ds = p_r(r)dr
    $$
    两边同时求积分可以知道
    $$
    \tag{二}
    s = T(r) = \int_{0}^{r}p_r(r)dr
    $$
    所以,变换函数就是$r$的累计直方图函数。

    + 将公式$(二)$推广到离散的数字图像,用频率代替概率,则变换函数$T(r_k)$的离散形式可表示为:
    $$
    s_k = T(r_k) = \sum_{j=0}^{k}p_r(r_j) = \sum_{j=0}^{k}\frac{n_j}{n}
    $$
    这表明,均衡化后各像素的灰度值$s_k$可直接由原图像的直方图计算出来.

  + 习题
  如有一幅总像素为$n=64\times64=4096$的图像，灰度级数为$8$,各灰度级分布列于表中。对其进行均衡化，计算过程如下：

  | $r_{k}$(归一化后的r取值) | $n_k$ | $p_r(r_k)=\frac{n_k}{n}$ |
  | :----------------------: | :---: | :----------------------: |
  |         $r_0=0$          |  790  | $\frac{790}{4096}=0.19$  |
  |    $r_1=\frac{1}{7}$     | 1023  | $\frac{1023}{4096}=0.25$ |
  |    $r_2=\frac{2}{7}$     |  850  | $\frac{850}{4096}=0.21$  |
  |    $r_3=\frac{3}{7}$     |  659  | $\frac{659}{4096}=0.16$  |
  |    $r_4=\frac{4}{7}$     |  329  | $\frac{329}{4096}=0.08$  |
  |    $r_5=\frac{5}{7}$     |  245  | $\frac{245}{4096}=0.06$  |
  |    $r_6=\frac{6}{7}$     |  122  | $\frac{122}{4096}=0.03$  |
  |         $r_7=1$          |  81   |  $\frac{81}{4096}=0.02$  |



| $r$  |  $r_k$(归一化后)  |      $s_k$       |    反归一化     |               $p_s(k)$                |
| :--: | :---------------: | :--------------: | :-------------: | :-----------------------------------: |
|  0   |      $r_0=0$      |      $0.19$      | $1.33\approx 1$ |    $p_s(1)=\frac{790}{4096}=0.19$     |
|  1   | $r_1=\frac{1}{7}$ | $0.19+0.25=0.44$ | $3.08\approx3$  |    $p_s(3)=\frac{1023}{4096}=0.25$    |
|  2   | $r_2=\frac{2}{7}$ | $0.44+0.21=0.65$ | $4.55\approx5$  |    $p_s(5)=\frac{850}{4096}=0.21$     |
|  3   | $r_3=\frac{3}{7}$ | $0.65+0.16=0.81$ | $5.67\approx6$  |  $p_s(6)=\frac{659+329}{4096}=0.24$   |
|  4   | $r_4=\frac{4}{7}$ | $0.81+0.08=0.89$ | $6.23\approx6$  |                   -                   |
|  5   | $r_5=\frac{5}{7}$ | $0.89+0.06=0.95$ | $6.65\approx7$  | $p_s(7)=\frac{245+122+81}{4096}=0.11$ |
|  6   | $r_6=\frac{6}{7}$ | $0.95+0.03=0.98$ | $6.86\approx7$  |                   -                   |
|  7   |      $r_7=1$      | $0.98+0.02=1.00$ |       $7$       |                   -                   |

  变换后只有5个等级了，分别为$1,3,5,6,7$.