

# 4.1.1 图像增强概述

+ 图像增强的概念和目的
  +  采用一系列技术__改善图像的视觉效果__,或将__图像转换__成一种更__适合__于人或机器进行__分析__和__处理__的形式.
  +  目的:
     +   改善图像的视觉效果;
     +   突出图像中感兴趣的信息，抑制不需要的信息，来提高图像的使用价值;
     +   转换为更适合人或机器分析处理的形式;
     +   需要注意的一点：增强后的图像不一定保真。
  
+ 图像增强的主要方法
  + 按照图像的作用域区分
    + __空间域增强__:直接对图像各像素进行处理
    + __频率域增强__:对图像经傅立叶变换后的频谱成分进行处理,然后逆傅立叶变换得到需要的图像

+ 图像增强的应用
    + 十分广泛


+ 图像增强的方法
  + __对比度增强__:扩大图像中感兴趣特征的目标
    + __灰度变换法__:通过调整__图像的灰度动态范围或调整图像的对比度__对图像进行增强.
      + 对比度:就是明暗的对比程度
      + __线性变换__:曝光不足或过曝，灰度会局限在很小的范围内，此时可以对曝光不足的图像用线性拉伸，可以有效的改善图像的视觉效果。
        + 分段线性变换:突出感兴趣的目标所在的灰度区间(被拉伸)，抑制不感兴趣的灰度区间(被压缩)
      + __对数变换__
      + __指数变换__
    + __直方图调整法__:
      + __直方图均衡化__
    + __空间域增强__:
    + __频率域增强__:



# 4.1.2 直方图均衡化

+ 灰度直方图的概念
  
+ 用来反应数字图像中每一个__灰度级__与这个灰度级__出现频率__之间的关系，可以描述图像的概貌。
  
+ 直方图修正法
  + 直方图均衡化(主要讲解))
  + 直方图规定化

+ 直方图均衡化
  + 将原图像通过某种变换，得到一副__灰度直方图均匀分布__的新图像.
  + 连续变化图像的均衡化问题:
  若$r$表示归一化的原图像灰度,$s$表示经过修正后的图像灰度.即
  $$
  T(r)=s,0\le r,s \le 1
  $$
  $T(r)$称为变换函数,需要满足以下条件:
  + 条件$1$:在$r\in [0,1]$内,$T(r)$单调递增;
  + 条件$2$:在$r\in [0,1]$内,有$0\le T(r)\le 1$
  条件$1$保证灰度级从黑到白的次序不变;
  条件$2$保证映射后的像素灰度在允许的范围内.
  则反变换关系为
  $$
  r = T^{-1}(s)
  $$
  显然$T^{-1}(s)$对$s$也要满足上述条件$1$和条件$2$.
  从概率论理论我们可以知道，如果已知随机变量$r$的概率密度为$p_r(r)$而随机变量$s$是$r$的函数,则$s$的概率密度$p_s(s)$可以由$p_r(r)$求出
  假定随机变量$s$的分布函数用$F_s(s)$表示,根据分布函数的定义,有(换个积分变量比较好,这里怕搞混直接用了)
  $$
  F_s(s)=\int_{-\infty}^{s}p_s(s)ds = \int_{-\infty}^{r}p_r(r)dr
  $$
  利用__密度函数是分布函数的导数的关系__,等式两边对$s$求导,可以得到:
  $$
  \tag{一}
  P_s(s)=\frac{d}{ds}\left[\int_{-\infty}^{r}p_r(r)dr\right] = p_r\frac{dr}{ds} = p_r\frac{d}{ds}\left[T^{-1}(s)\right]
  $$
  公式$(一)$是__直方图修正级数的基础__:可以通过变换函数$T(r)$控制原图像原图像灰度级的概率密度函数$p_r$，得到输出图像的概率密度函数$p_s$，因此可以改善原图像的灰度层次。
  + 从__人眼视觉特性__来考虑,一副图像的直方图如果是__均匀分布__的，即$P_s(s)=k$(归一化后$k=1$),__该图像色调给人的感觉比较协调__。所以将原图像的直方图均衡化后，可以满足人眼的视觉要求.

  + 如何求出$T(r)$
    +  根据归一化假设
    $$
    P_s(s) = 1
    $$
    由公式$(一)$得到(左边等于1):
    $$
    ds = p_r(r)dr
    $$
    两边同时求积分可以知道
    $$
    \tag{二}
    s = T(r) = \int_{0}^{r}p_r(r)dr
    $$
    所以,变换函数就是$r$的累计直方图函数。

    + 将公式$(二)$推广到离散的数字图像,用频率代替概率,则变换函数$T(r_k)$的离散形式可表示为:
    $$
    s_k = T(r_k) = \sum_{j=0}^{k}p_r(r_j) = \sum_{j=0}^{k}\frac{n_j}{n}
    $$
    这表明,均衡化后各像素的灰度值$s_k$可直接由原图像的直方图计算出来.

  + 习题
  如有一幅总像素为$n=64\times64=4096$的图像，灰度级数为$8$,各灰度级分布列于表中。对其进行均衡化，计算过程如下：

  | $r_{k}$(归一化后的r取值) | $n_k$ | $p_r(r_k)=\frac{n_k}{n}$ |
  | :----------------------: | :---: | :----------------------: |
  |         $r_0=0$          |  790  | $\frac{790}{4096}=0.19$  |
  |    $r_1=\frac{1}{7}$     | 1023  | $\frac{1023}{4096}=0.25$ |
  |    $r_2=\frac{2}{7}$     |  850  | $\frac{850}{4096}=0.21$  |
  |    $r_3=\frac{3}{7}$     |  659  | $\frac{659}{4096}=0.16$  |
  |    $r_4=\frac{4}{7}$     |  329  | $\frac{329}{4096}=0.08$  |
  |    $r_5=\frac{5}{7}$     |  245  | $\frac{245}{4096}=0.06$  |
  |    $r_6=\frac{6}{7}$     |  122  | $\frac{122}{4096}=0.03$  |
  |         $r_7=1$          |  81   |  $\frac{81}{4096}=0.02$  |

  | $r$  |  $r_k$(归一化后)  |      $s_k$       |    反归一化     |               $p_s(k)$                |
  | :--: | :---------------: | :--------------: | :-------------: | :-----------------------------------: |
  |  0   |      $r_0=0$      |      $0.19$      | $1.33\approx 1$ |    $p_s(1)=\frac{790}{4096}=0.19$     |
  |  1   | $r_1=\frac{1}{7}$ | $0.19+0.25=0.44$ | $3.08\approx3$  |    $p_s(3)=\frac{1023}{4096}=0.25$    |
  |  2   | $r_2=\frac{2}{7}$ | $0.44+0.21=0.65$ | $4.55\approx5$  |    $p_s(5)=\frac{850}{4096}=0.21$     |
  |  3   | $r_3=\frac{3}{7}$ | $0.65+0.16=0.81$ | $5.67\approx6$  |  $p_s(6)=\frac{659+329}{4096}=0.24$   |
  |  4   | $r_4=\frac{4}{7}$ | $0.81+0.08=0.89$ | $6.23\approx6$  |                   -                   |
  |  5   | $r_5=\frac{5}{7}$ | $0.89+0.06=0.95$ | $6.65\approx7$  | $p_s(7)=\frac{245+122+81}{4096}=0.11$ |
  |  6   | $r_6=\frac{6}{7}$ | $0.95+0.03=0.98$ | $6.86\approx7$  |                   -                   |
  |  7   |      $r_7=1$      | $0.98+0.02=1.00$ |       $7$       |                   -                   |

  变换后只有5个等级了，分别为$1,3,5,6,7$.

  + 当原始图像的直方图不同而图像结构相同时,直方图均衡化所得到的结果在视觉上几乎是完全一致的.
  + 从灰度直方图的意义上说,如果一幅图像的直方图非零范围占有所有可能的灰度级并在在这些灰度级上均匀分布,那么这幅图像的对比度较高,而且灰度色调较为丰富,从而容于判读.







# 4.1.3 直方图规定化(精通Matlab数字图像处理与识别 张铮 Page63)
+ __直方图均衡化__可以自动确定灰度变换函数,从而获得均有均匀直方图的输出图像,他主要用于__增强动态范围偏小的图像对比度__,丰富图像的灰度级,这种方法的有点事操作简单,且结果可以预知,当图像需要__自动增强__时是一种不错的选择.

+ 有时,我们希望对变换过程进行控制:如能够__人为地修正直方图的形状__,或者说是具有__指定直方图__的输出图像.这样就可以有选择地增强某个灰度范围内的对比度或使图像灰度值满足某种特定的分布.

+ 这种用于产生具有特定直方图的图像的方法叫做:__直方图规定化__,或__直方图匹配__.

+ 理论基础:在运用均衡化原理的基础上,通过建立__原始图像__和__期望图像__(待匹配直方图的图像)之间的关系,使原始图像的直方图匹配特定的形状,从而弥补直方图不具备交互作用的特性.
  + 先对原始的图像进行均衡化
  $$
  \tag{4-7}
  s=f(r)=\int_{0}^{r}p_{r}(\mu )d\mu
  $$
  + 同时对待匹配直方图的图像进行均衡化处理
  $$
  \tag{4-8}
  v = g(z) = \int_{0}^{z}p_z(\lambda )d\lambda
  $$
  + 令$s=v$,可以得到
  
  $$
  \tag{4-9}
  v = g^{-1}(s) = g^{-1}(f(r))
  $$
  
  + 根据$\tag{4-7}$我们可以得到$f(r)$,根据$\tag{4-8}$我们可以得到$g(z)$,并且得到反函数$g^{-1}(z)$,对__原始输入图像??__应用$\tag{4-9}$公式进行变换,这样就执行了均衡化的逆处理.
  
+ 直方图规定化本质一种拟合过程,因此变换得到的直方图与标准目标图像的直方图并不会完全一致,然而即使只是相似的拟合,仍然使得规定化后的图像在亮度与对比度上具有类似标准图像的特性，正是直方图规定化的目的.

+ [习题](https://www.jianshu.com/p/a99c3c5b54b4)
  + 考虑一个$64\times 64$的假设图像,其直方图概率分布如下表第三列,希望直方图变换为下表第二列中规定的值.
  
    |  $Z_q$  | 规定的$p_z(Z_q)$ | 实际的$p_z(Z_k)$ |
    | :-----: | :--------------: | :--------------: |
    | $z_0=0$ |      $0.00$      |      $0.00$      |
    | $z_1=1$ |      $0.00$      |      $0.00$      |
    | $z_2=2$ |      $0.00$      |      $0.00$      |
    | $z_3=3$ |      $0.15$      |      $0.19$      |
    | $z_4=4$ |      $0.20$      |      $0.25$      |
    | $z_5=5$ |      $0.30$      |      $0.21$      |
    | $z_6=6$ |      $0.20$      |      $0.24$      |
    | $z_7=7$ |      $0.15$      |      $0.11$      |
  
  + 第一步对原始图像进行均衡化:
    $$
    \begin{eqnarray}
    f(r=z_0)&=&\frac{0}{1}*7=0\\
    f(r=z_1)&=&\frac{0+0}{1}*7=0\\
    f(r=z_2)&=&\frac{0+0+0}{1}*7=0\\
    f(r=z_3)&=&\frac{0+0+0+0.19}{1}*7=1.33\approx 1 \\
    f(r=z_4)&=&\frac{0+0+0+0.19+0.25}{1}*7=3.08\approx 3 \\
    f(r=z_5)&=&\frac{0+0+0+0.19+0.25+0.21}{1}*7=4.55\approx 5 \\
    f(r=z_6)&=&\frac{0+0+0+0.19+0.25+0.21+0.24}{1}*7=6.23\approx 6 \\
    f(r=z_7)&=&7
    \end{eqnarray}
    $$
    
  + 可以得到$f(r)$
  
    | $f(r)$  | $p_r(r_k)$ |
    | :-----: | :--------: |
    | $r_0=0$ |   $0.00$   |
    | $r_1=1$ |   $0.19$   |
    | $r_2=3$ |   $0.25$   |
    | $r_3=5$ |   $0.21$   |
    | $r_4=6$ |   $0.24$   |
    | $r_5=7$ |   $0.11$   |
  
    
  
  + 第二步对目标直方图进行归一化
    $$
    \begin{eqnarray}
    g(z=z_0) &=&\frac{0}{1}*7 = 0\\
    g(z=z_1) &=&\frac{0+0}{1}*7 = 0\\
    g(z=z_2) &=&\frac{0+0+0}{1}*7 = 0\\ 
    g(z=z_3) &=&\frac{0+0+0+0.15}{1}*7 = 1.05 \approx 1  \\    
    g(z=z_4) &=&\frac{0+0+0+0.15+0.20}{1}*7 = 2.45 \approx 2  \\
    g(z=z_5) &=&\frac{0+0+0+0.15+0.20+0.30}{1}*7 = 4.55 \approx 5  \\  
    g(z=z_6) &=&\frac{0+0+0+0.15+0.20+0.30+0.20}{1}*7 = 5.95 \approx 6  \\  
    g(z=z_7) &=&7
    \end{eqnarray}
    $$
    
  + 对$g(z)$取反函数可以得到
    $$
    \begin{eqnarray}
    g^{-1}(z=0) &=&0,1,2  \\
    g^{-1}(z=1) &=&3      \\    
    g^{-1}(z=2) &=&4      \\
    g^{-1}(z=5) &=&5      \\
    g^{-1}(z=6) &=&6      \\
    g^{-1}(z=7) &=&7
    \end{eqnarray}
  $$
  + 根据$v=g^{-1}(f(r))$,可以得到直方图规定化后的变换关系.
  
  | $p_r(r_k)$ | $f(r)$ |       $v_c$       | $v$  |
  | :--------: | :----: | :---------------: | :--: |
  |   $0.00$   |  $0$   | $g^{-1}(0)=0,1,2$ | $0$  |
  |   $0.19$   |  $1$   |   $g^{-1}(1)=3$   | $3$  |
  |   $0.25$   |  $3$   |  $g^{-1}(3)=???$  | $4$  |
  |   $0.21$   |  $5$   |   $g^{-1}(5)=5$   | $5$  |
  |   $0.24$   |  $6$   |   $g^{-1}(6)=6$   | $6$  |
|   $0.11$   |  $7$   |   $g^{-1}(7)=7$   | $7$  |
  + 对比一下规定化后的图像直方图分布和模板直方图.
  
    | $Z_k$ | $p_z(z_k)$ | $p_v(v_k)$ | $$p_r(r_k)$$ | $p_z(Z_q)$ |
    | :---: | :--------: | :--------: | :----------: | :--------: |
    |  $0$  |   $0.00$   |   $0.00$   |    $0.00$    |   $0.00$   |
    |  $1$  |   $0.00$   |   $0.00$   |    $0.19$    |   $0.00$   |
    |  $2$  |   $0.00$   |   $0.00$   |    $0.00$    |   $0.00$   |
    |  $3$  |   $0.19$   |   $0.19$   |    $0.25$    |   $0.15$   |
    |  $4$  |   $0.25$   |   $0.25$   |    $0.00$    |   $0.20$   |
    |  $5$  |   $0.21$   |   $0.21$   |    $0.21$    |   $0.30$   |
    |  $6$  |   $0.24$   |   $0.24$   |    $0.24$    |   $0.20$   |
    |  $7$  |   $0.11$   |   $0.11$   |    $0.11$    |   $0.15$   |
  





# 4.2.1 图像增强-图像的空间域平滑

+ 图像平滑也称为__图像去噪__,是为了抑制图像噪声改善图像质量进行的处理。
+ 几种空间域的图像平滑方法：
  + 邻域平均法
  + 超限像素平滑法
  + 由选择包边缘平滑法
  + 中值滤波法



+ __邻域平均法__

  + 直接在空间域上进行平滑处理。

  + 思想：假设图像由__灰度恒定的小块组成，相邻的像素之间存在很高的相关性，而噪声则是统计独立的__。所以可以用__邻域内各像素的灰度平均值代替原来的灰度值__，实现图像的平滑。

  + 原图像为$N\times N$大小的$f(x,y)$，平滑后的图像为$g(x,y)$,则{}
    $$
    g(x,y)=\frac{1}{M}\sum_{i,j\in s}f(x,y)
    $$
    其中$s$为邻域矩阵，$M$为邻域矩阵的像素个数。

  + 若为$3\times 3$的邻域平均法，则相当于用矩阵$A$与图像$f(x,y)$进行卷积，其中
    $$
    \begin{eqnarray}
    A&=&\frac{1}{9}
    \left[
    \begin{matrix}
    1 & 1& 1\\
    1 & 1& 1\\
    1 & 1& 1
    \end{matrix}
    \right]\\
    g(m,n)&=&\frac{1}{9}\sum_{i,j}f(m+i,n+j)
    \end{eqnarray}
    $$

  + 我们假设图像中的噪声是随机不相关的加性噪声，窗口内各点的噪声是独立同分布的，经过平滑后，信号与噪声的方差比可望提高$M$倍。(todo?????)

  + 优点：算法简单。

  + 缺点：在降低噪声的同时__会使得图像产生模糊__，特别是在边缘和细节处，而且__邻域越大，去噪能力增强的同时模糊程度越严重__。

  + 为了客服简单局部平均法的缺点，目前提出了许多__保边缘、细节__的局部平滑算法,如__超限像素平滑法__。



+ __超限像素平滑法__

  + 对邻域平均法稍加改进，把$f(x,y)$和邻域平均得到的$g(x,y)$值做一个差的绝对值，再与选定的阈值做比较，用比较的结果决定$(x,y)$位置的灰度值$g'(x,y)$:
    $$
    g'(x,y)=
    \begin{cases}
    g(x,y), |f(x,y)-g(x,y)|\ge T\\
    f(x,y), |f(x,y)-g(x,y)|\le T
    \end{cases}
    $$

  + 特点：

    + 能有效抑制椒盐噪声
    + 能较好的保护微小灰度差的细节和纹理。



+ __有选择保边缘平滑法__
  + 对图像上任一像素$x,y$的$5\times 5$邻域，采用$9$个掩模，包括$3\times 3$,$4$个五边形，$4$个六边形。计算对应各个掩模覆盖的__9种__组合所包含数据的均值和方差，__对方差进行排序，最小方差所对应的掩模区的灰度均值就是像素$(x,y)$的输出值__。
  + 这种方法用__方差__ 来测度区域的灰度均匀性，如果区域含有尖锐的边缘，灰度方差就会很大，反之，方差就小，故__最小方差所对应的区域就是灰度最均匀的区域__.
  + 这种平滑方法既能消除噪声，由不会破坏区域边界的细节。
  + 五边形和六边形在$(x,y)$处都有锐角，即便像素$(x,y)$位于一个复杂形状区域的锐角处，也能找到均匀的区域。从而在平滑时既不会使得尖锐边缘模糊，也不会破坏边缘形状。




# 4.2.2 图像增强-中值滤波法

+ 用一个__滑动窗口__,对窗口内的像素灰度值__排序__,用中值代替窗口中心像素的灰度值，是一种__非线性__的图像平滑法。
+ 中值滤波法对__脉冲干扰__及__椒盐噪声__的抑制效果很好,在抑制随机噪声的同时,还能够保护边缘少受模糊。
+ 但对点、线__细节较多的图像不太适合__。
+  最重要的环节：__选择窗口尺寸的大小__
  + 通常很难事先就确定出最佳的窗口尺寸，需要通过从小窗口到大窗口的中值滤波试验，再从中选取最合适的窗口。
+ 对于离散的脉冲信号，__当连续出现的次数小于窗口尺寸的一半时，将被抑制掉__。
+ 二维中值滤波器的窗口形状可以由很多种，如线状，方形，十字行形，圆形，菱形等。
  + 方形或圆形适宜于外轮廓线较长的物体图像；
  + 十字形窗口对有尖顶角状的图像效果好。





# 4.3 图像的空间域锐化

+ 锐化的目的是__增强图像的边缘或轮廓__。

+ 图像的平滑是通过__积分过程__使图像边缘模糊，而图像锐化是通过__微分过程__使图像边缘突出、清晰。

+ 最常使用的图像锐化法-__梯度法__

  + 图像$f(x,y)$在$(x,y)$处的梯度为
    $$
    grad(x,y)=
    \left[
    \begin{matrix}
    f_x'\\
    f_y'
    \end{matrix}
    \right]
    =
    \left[
    \begin{matrix}
    \frac{\partial f(x,y)}{\partial  x}\\
    \frac{\partial f(x,y)}{\partial  y}
    \end{matrix}
    \right]
    $$

  + 梯度是一个具有大小和方向的矢量。

  + 对于离散图像出来说，经常用梯度的大小，来表示“梯度”，所以上式的一阶偏导可以用一阶差分来近似表示，即
    $$
    f_x'=f(x+1,y)-f(x,y)\\
    f_y'=f(x,y+1)-f(x,y)
    $$
  
  + 为了简化梯度的计算，通常使用
    $$
    grad(x,y) = \max(|f_x'|,|f_y'|)\\
    grad(x,y) = |f_x'| + |f_y'|
    $$
  
  + 对应的梯度算子为:
    $$
    [-1,1] or [-1,1]^T
    $$
  
+ 除了__梯度算子__以外，还有__Roberts__,__Prewitt__和__Soble__算子也可以用来计算梯度，增强边缘。

  + __Roberts__算子：

    + 差分计算式为$f_x'=|f(x+1,y+1)-f(x,y)|,f_y'=|f(x+1,y)-f(x,y+1)|$,对应的算子为
      $$
      \left[
      \begin{matrix}
      -1 && 0 \\
      0 && 1
      \end{matrix}
      \right]
      and
      \left[
      \begin{matrix}
      0 && 1 \\
      -1 && 0
      \end{matrix}
      \right]
      $$

  + __Prewitt__和__Sobel__算子：

    + 加大了边缘增强算子的模板大小，由$2\times 2$扩大到$3\times 3$，__在边缘锐化的同时减少噪声的影响__。

    + __Prewitt__算子的矩阵形式是:
      $$
      \left[
      \begin{matrix}
      -1 && 0 && 1 \\
      -1 && 0 && 1 \\
      -1 && 0 && 1 \\
      \end{matrix}
      \right]
      and
      \left[
      \begin{matrix}
      -1 && -1 && -1 \\
      0 && 0 && 0 \\
      1 && 1 && 1 \\
      \end{matrix}
      \right]
      $$

    + __Sobel__算子的矩阵形式是(对4邻域的权重加大了):
      $$
      \left[
      \begin{matrix}
      -1 && 0 && 1 \\
      -2 && 0 && 2 \\
      -1 && 0 && 1 \\
      \end{matrix}
      \right]
      and
      \left[
      \begin{matrix}
      -1 && -2 && -1 \\
      0 && 0 && 0 \\
      1 && 2 && 1 \\
      \end{matrix}
      \right]
      $$

+ __梯度阈值控制__：

  + 直接采用梯度输出，仅显示灰度变化比较陡的边缘轮廓，而灰度变化比较平缓或均匀的区域则呈黑色。

  + 增加一个非负的阈值，适当选择$T$,可以使明显的边缘轮廓得到突出，又不会破坏原来平缓的背景。
    $$
    g(x,y)=
    \begin{cases}
    grad{x,y},grad(x,y)\ge T\\
    f(x,y),grad(x,y)\le T
    \end{cases}
    $$

  + 可以把明显的边缘用一个固定的灰度级$L_G$来表示：
    $$
    g(x,y)=
    \begin{cases}
    L_G,grad(x,y)\ge T\\
    f(x,y),grad(x,y)\le T
    \end{cases}
    $$

  + 可以把背景用一个固定的灰度级$L_B$来表示：
    $$
    g(x,y)=
    \begin{cases}
    grad(x,y),grad(x,y)\ge T\\
    L_B,grad(x,y)\le T
    \end{cases}
    $$

  + 还可以把边缘和背景分别用$L_G$和$L_B$来表示，生成二值图像。



+ __Laplacian__增强算子

  + 是线性二阶微分算子，即
    $$
    \nabla{^2f(x,y)}=\frac{\part ^2f(x,y)}{\part^2 x}+\frac{\part ^2f(x,y)}{\part^2 y}
    $$

  + 对于离散的数字图像，二阶偏导数可以用二阶差分近似，可以得出Laplacian算子的表达式为:
    $$
    \nabla^2f(x,y)=f(x+1,y)+f(x-1,y)+f(x,y+1)+f(x,y-1)-4f(x,y)
    $$

  + 对应的矩阵算子为
    $$
    \left[
    \begin{matrix}
    0 && 1  && 0 \\
    1 && -4 && 1 \\
    0 && 1 && 0
    \end{matrix}
    \right]
    $$

  + Lapacian增强算子为:
    $$
    \left[
    \begin{matrix}
    0 && -1  && 0 \\
    -1 && 5 && -1 \\
    0 && -1 && 0
    \end{matrix}
    \right]
    $$

  + 算子特点
    + 在灰度均匀的区域或者坡度中间二阶差分为0，增强图像上像元灰度不变(todo????)
    + 在斜坡底或底灰度侧形成“下冲”，在斜坡顶或搞灰度侧形成“上冲".(todo?????)


+ 高通滤波法:
  + 使用高通滤波算子和图像卷积来增强边缘，常用的算子有:
    $$
H_1=
    \left[
    \begin{matrix}
    0 && -1  && 0 \\
    -1 && 5 && -1 \\
    0 && -1 && 0
    \end{matrix}
    \right] 
    or
    H_2=
    \left[
    \begin{matrix}
    -1 && -1  && -1 \\
    -1 && 9 && -1 \\
    -1 && -1 && -1
    \end{matrix}
    \right]
    $$
    
    
    
# 4.4 图像的频率域增强    

+ 基本原理:假定原图像为$f(x,y)$,经傅里叶变换为$F(u,v)$，选择合适的滤波器$H(u,v)$对$F(u,v)$的频谱成分进行处理，然后经逆傅里叶变换得到增强的图像$g(x,y)$.

  ```mermaid
  graph LR;
  A[f]--DFT-->B[F]
  B--H 滤波-->C[FH]
C--IDFT-->D[g]
  
  ```
  
+ 频率域平滑

  + 图像的噪声主要集中集中在高频部分，要去除高频分量，可以设计低通滤波器来抑制高频成分.

  + __理想低通滤波器__

    + 假设傅里叶平面上理想低通滤波器离开原点的截止频率为$D_0$,则理想低通滤波器的传递函数为
      $$
      H(u,v)=
      \begin{cases}
      1,D(u,v)\le D_0\\
      0,D(u,v)\gt D_0
      \end{cases}
      $$

    + 由于高频成分包含有大量的边缘信息，采用该滤波器在去噪声的同时会导致边缘信息损失使图像边缘模糊.

  + __巴特沃斯(butterworth)滤波器__
    
    + $n$阶butterworth滤波器的传递函数为:
    $$
    H(u,v)=\frac{1}{1+\left[\frac{D(u,v)}{D_0}\right]^{2n}}
    $$

    + 巴特沃斯的特性是__连续性衰减__,不像__理想滤波器那样是陡峭变换和明显的不连续性__.

    + 这个滤波器在抑制噪声的同时,图像边缘的模糊程度大大减小,__没有振铃效应产生__.

  + __指数低通滤波器__
    
    + 传递函数为:
      $$
      H(u,v) = e^{-\left[ \frac{D(u,v)}{D_0}\right]^n}
      $$
    
    + 这个滤波器滤波在抑制噪声的同时,图像边缘的模糊程度比用Butterworth滤波产生的程度大些(指数衰减得更快),也没有明显的振铃效应.

  + __梯形低通滤波器__
    
    + 梯形低通滤波器是理想提荣滤波器和完全平滑滤波器的__折中__,他的传递函数为:
    $$
    H(u,v) = 
    \begin{cases}
    1,D(u,v)\le D_0\\
    \frac{D(u,v)-D_1}{D_0-D_1},D_0\le D(u,v) \le D_1\\
    0,D(u,v) \gt D_1
    \end{cases}
    $$

    + 它的性能介于理想低通滤波器和指数滤波器之间，__滤波后的图像具有一定的模糊和振铃效应__.

# 4.5 彩色增强技术

+ __伪彩色增强__(灰度图像-->彩色图像)
  + 原理:人眼的视觉特性.
    + 人眼的灰度级介于十几到二十几级之间.
    + 彩色分辨能力可达到灰度分辨能力的百倍以上.

  + 是把黑白图像的各个不同灰度级按照线性或非线性的映射函数变换成不同的彩色，得到一幅彩色图像的技术.

    + 密度分割法
      
      + 把黑白图像的灰度级从$0$(黑)到$M_0$(白)分成$N$个区间$L_i(i=1,2,...,N)$,给每个区间$L_i$指定一种彩色$C_i$,这样就可以把一幅灰度图像变成一幅伪彩色图像.

      +  优点:方法简单、直观;缺点:变换出的彩色数目有限.

    + 灰度级-彩色变换
      
      + 根据色度学原理，将原灰度图像$f(x,y)$的灰度范围分段，经过红、绿和蓝三种不同变换$T_R(\dots )$、$T_G(\dots )$和$T_B(\dots )$,变成三基色分量$I_R(x,y)$、$I_G(x,y)$和$I_B(x,y)$,然后用他们分别去控制彩色显示器的红、绿和蓝电子枪，便可以在彩色显示器的屏幕上合成一幅彩色图像.



+ __假彩色合成__(彩色图像-->彩色图像)

  + 原理:对一幅自然彩色图像或同一景物的多光谱图像，通过映射函数变换成新的三基色分量，彩色合成使感兴趣目标呈现出与原图像中不同的、奇异的彩色

  + 目的:一是使感兴趣的目标呈现奇异的彩色或置于奇特的彩色环境中，从而更引人注目；二则使景物呈现出与人眼色觉相匹配的颜色，以提高对目标的分辨力.

  + 线性假彩色：
    $$
    \left[
    \begin{matrix}
    R_F\\G_F\\B_F
    \end{matrix}
    \right]
    =
    \left[
    \begin{matrix}
    a_1 & b_1 & c_1\\
    a_2 & b_2 & c_2\\
    a_3 & b_3 & c_3\\
    \end{matrix}
    \right]
    \left[
    \begin{matrix}
    R_f\\G_f\\B_f
    \end{matrix}
    \right]
    $$

  + 应用：把多个波段的图像分别赋予一种原色而进行彩色合成的处理方法 。在遥感中，因多波段图像在获取时会受到大气吸收、散射等影响，一般__(短波)蓝波段损失严重，在彩色合成时要用其他波段（包括非可见光波段）代替__，边得到与自然景色相同的真彩色图像，故称其为假彩色合成.

  

  


+ __彩色变换__
  
  + 原理:将RGB彩色图像经过HIS变换，获得$H$、$I$和$S$三分量,根据需要对三分量进行增强,在经过反变换可得到增强的$RGB$彩色图像.
    + $H$-色调
    + $I$-亮度
    + $S$-饱和度

  + 应用
    + 多遥感影像融合:将覆盖同一地区(或对象)的两幅或多幅空间配准的影像生成满足某种要求的影像的技术(高分辨率替代I分量，多光谱高分辨率).
    
      ```mermaid
      graph LR
      A(多光谱影响)--HSI变换-->B(H I S )
      B-->F(分量替换)
      F-->C(H S P)
      C--逆变换-->D(融合的多光谱影像)
      E(其他传感器影像P)-->F
      ```

    + 不同传感器数据融合影像
      + 绿色波段、红色波段、近红外波段、SAR(合成孔径雷达)影像
      + 绿+红+近红外 假彩色合成一张图片
      + 利用提取SAR影像的整个替换假彩色图片的$I$分量.
    
      
    
      
    










​    

​    


​    
​    
​    
​    
​    
​    
​    
​    
​    
​    
​    
​    
​    
​      